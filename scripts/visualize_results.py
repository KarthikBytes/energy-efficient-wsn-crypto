# -*- coding: utf-8 -*-
"""visualize_results.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1cc8Ed11Xu9ND1iOfJW55TGAf6CF3Q8Ks
"""

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import seaborn as sns

protocols = ['OLSR', 'AODV', 'LEACH', 'MEMOSTP (Ours)']

data = {
    'PDR (%)': [76.4, 82.1, 85.5, 93.8],
    'Avg Delay (s)': [0.142, 0.115, 0.095, 0.078],
    'Throughput (Mbps)': [1.15, 1.32, 1.45, 1.68],
    'Total Energy (J)': [48.5, 42.3, 39.8, 31.2],
    'Energy Efficiency (pkts/J)': [120, 145, 160, 210]
}

df = pd.DataFrame(data, index=protocols).reset_index().rename(columns={'index': 'Protocol'})

sns.set_theme(style="whitegrid")
fig, axes = plt.subplots(2, 2, figsize=(18, 14))
fig.suptitle(
    'Comparative Performance Analysis: MEMOSTP vs Standard WSN Protocols',
    fontsize=26,
    fontweight='bold',
    y=1.02
)

protocol_colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728']

def add_labels(ax):
    for p in ax.patches:
        ax.annotate(
            f'{p.get_height():.2f}',
            (p.get_x() + p.get_width() / 2., p.get_height()),
            ha='center',
            va='center',
            xytext=(0, 9),
            textcoords='offset points',
            fontsize=12,
            fontweight='bold'
        )

sns.barplot(
    data=df, x='Protocol', y='PDR (%)',
    ax=axes[0, 0], palette=protocol_colors,
    hue='Protocol', legend=False
)
axes[0, 0].set_title('Packet Delivery Ratio (PDR)', fontsize=18)
axes[0, 0].set_ylim(0, 110)
add_labels(axes[0, 0])
axes[0, 0].tick_params(axis='x', labelsize=13)
axes[0, 0].tick_params(axis='y', labelsize=13)
axes[0, 0].set_xlabel('Protocol', fontsize=15)
axes[0, 0].set_ylabel('PDR (%)', fontsize=15)

sns.barplot(
    data=df, x='Protocol', y='Avg Delay (s)',
    ax=axes[0, 1], palette=protocol_colors,
    hue='Protocol', legend=False
)
axes[0, 1].set_title('Average End-to-End Delay', fontsize=18)
add_labels(axes[0, 1])
axes[0, 1].tick_params(axis='x', labelsize=13)
axes[0, 1].tick_params(axis='y', labelsize=13)
axes[0, 1].set_xlabel('Protocol', fontsize=15)
axes[0, 1].set_ylabel('Avg Delay (s)', fontsize=15)

sns.barplot(
    data=df, x='Protocol', y='Total Energy (J)',
    ax=axes[1, 0], palette=protocol_colors,
    hue='Protocol', legend=False
)
axes[1, 0].set_title('Total Network Energy Consumption', fontsize=18)
add_labels(axes[1, 0])
axes[1, 0].tick_params(axis='x', labelsize=13)
axes[1, 0].tick_params(axis='y', labelsize=13)
axes[1, 0].set_xlabel('Protocol', fontsize=15)
axes[1, 0].set_ylabel('Total Energy (J)', fontsize=15)

sns.barplot(
    data=df, x='Protocol', y='Throughput (Mbps)',
    ax=axes[1, 1], palette=protocol_colors,
    hue='Protocol', legend=False
)
axes[1, 1].set_title('Network Throughput', fontsize=18)
add_labels(axes[1, 1])
axes[1, 1].tick_params(axis='x', labelsize=13)
axes[1, 1].tick_params(axis='y', labelsize=13)
axes[1, 1].set_xlabel('Protocol', fontsize=15)
axes[1, 1].set_ylabel('Throughput (Mbps)', fontsize=15)

plt.tight_layout(rect=[0, 0.03, 1, 0.98])

base_olsr = df.iloc[0]
target_memo = df.iloc[3]

improvement = {
    'PDR ↑': ((target_memo['PDR (%)'] - base_olsr['PDR (%)']) / base_olsr['PDR (%)']) * 100,
    'Delay ↓': ((base_olsr['Avg Delay (s)'] - target_memo['Avg Delay (s)']) / base_olsr['Avg Delay (s)']) * 100,
    'Energy Saving ↑': ((base_olsr['Total Energy (J)'] - target_memo['Total Energy (J)']) / base_olsr['Total Energy (J)']) * 100,
    'Efficiency ↑': ((target_memo['Energy Efficiency (pkts/J)'] - base_olsr['Energy Efficiency (pkts/J)']) / base_olsr['Energy Efficiency (pkts/J)']) * 100
}

plt.figure(figsize=(12, 7))
colors = ['#2ca02c' if x > 0 else '#d62728' for x in improvement.values()]
plt.bar(improvement.keys(), improvement.values(), color=colors, alpha=0.8)
plt.axhline(0, color='black', linewidth=1.0)
plt.title('Percentage Improvement: MEMOSTP (Ours) vs. Standard OLSR', fontsize=18)
plt.ylabel('Improvement Percentage (%)', fontsize=15)
plt.xlabel('Metric', fontsize=15)
plt.xticks(fontsize=13)
plt.yticks(fontsize=13)
plt.grid(axis='y', linestyle='--', alpha=0.6)

for i, v in enumerate(improvement.values()):
    plt.text(
        i,
        v + (2 if v > 0 else -5),
        f'{v:.1f}%',
        ha='center',
        fontweight='bold',
        fontsize=13
    )

plt.show()